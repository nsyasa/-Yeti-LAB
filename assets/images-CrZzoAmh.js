const s={config:{onUpdate:null,getCourseData:()=>window.courseData||{}},targetInputId:null,targetInputId2:null,init(e){this.config={...this.config,...e}},openSelector(e,t=null){this.targetInputId=e,this.targetInputId2=t;const i=document.getElementById("image-selector-modal");i&&(i.classList.remove("hidden"),this.loadImageList())},closeSelector(){const e=document.getElementById("image-selector-modal");e&&e.classList.add("hidden"),this.targetInputId=null,this.targetInputId2=null},async loadImageList(){const e=document.getElementById("image-selector-grid");if(!e)return;e.innerHTML='<div class="col-span-full text-center p-4">Yükleniyor...</div>';const t=new Set,i=this.config.getCourseData();if(Object.values(i).forEach(n=>{n&&n.data&&((n.data.projects||[]).forEach(a=>{a.circuitImage&&t.add(a.circuitImage),a.code&&a.code.match(/\.(png|jpg|jpeg|gif)$/i)&&t.add(a.code)}),Object.values(n.data.componentInfo||{}).forEach(a=>{a.imgFileName&&t.add(a.imgFileName)}))}),["arduino_uno.jpg","breadboard.jpg","led_red.jpg","resistor.jpg","buzzer.jpg"].forEach(n=>t.add(n)),e.innerHTML="",t.size===0){e.innerHTML='<div class="col-span-full text-center p-4 text-gray-500">Kayıtlı resim bulunamadı.</div>';return}Array.from(t).sort().forEach(n=>{const a=document.createElement("div");a.className="border rounded cursor-pointer hover:border-blue-500 hover:shadow-md transition p-1 bg-white flex flex-col items-center",a.onclick=()=>this.selectImage(n),a.innerHTML=`
                <div class="w-full h-24 bg-gray-100 mb-1 flex items-center justify-center overflow-hidden">
                    <img src="img/${n}" class="max-w-full max-h-full object-contain" loading="lazy" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNSIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNjY2MiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cmVjdCB4PSIzIiB5PSIzIiB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHJ4PSIyIiByeT0iMiIvPjxjaXJjbGUgY3g9IjguNSIgY3k9IjguNSIgcj0iMS41Ii8+PHBvbHlsaW5lIHBvaW50cz0iMjEgMTUgMTYgMTAgNSAyMSIvPjwvc3ZnPg=='">
                </div>
                <span class="text-[10px] text-gray-600 truncate w-full text-center" title="${n}">${n}</span>
            `,e.appendChild(a)})},selectImage(e){if(this.targetInputId){const t=document.getElementById(this.targetInputId);t&&(t.value=e,t.dispatchEvent(new Event("input")),t.dispatchEvent(new Event("change")))}if(this.targetInputId2){const t=document.getElementById(this.targetInputId2);t&&(t.value=e,t.dispatchEvent(new Event("input")),t.dispatchEvent(new Event("change")))}this.closeSelector()},previewCircuitImage(){const e=document.getElementById("p-circuitImage"),t=document.getElementById("circuit-image-preview"),i=document.getElementById("circuit-preview-img");if(!e||!t||!i)return;const n=e.value.trim();if(!n){t.classList.add("hidden");return}const a=this.resolveImageUrl(n);i.src=a,i.onload=()=>t.classList.remove("hidden"),i.onerror=()=>t.classList.add("hidden")},async uploadCircuitImage(e){const t=e.files[0];if(!t)return;const i=document.getElementById("autosave-status");i&&(i.textContent="⬆️ Resim yükleniyor...",i.classList.add("text-yellow-400"));try{if(!window.SupabaseClient||!window.SupabaseClient.getClient())throw new Error("Supabase client not initialized");const n=await window.SupabaseClient.uploadImage(t,"circuits"),a=document.getElementById("p-circuitImage");a&&(a.value=n,this.previewCircuitImage()),i&&(i.textContent="✅ Resim yüklendi!",i.classList.remove("text-yellow-400"),i.classList.add("text-green-400")),this.config.onUpdate&&this.config.onUpdate()}catch(n){console.error("Image upload error:",n),i&&(i.textContent="❌ Yükleme hatası!",i.classList.remove("text-yellow-400"),i.classList.add("text-red-400")),alert("Resim yüklenemedi: "+n.message+`

Alternatif: Dosya adını manuel girin veya harici URL kullanın.`)}e.value=""},resolveImageUrl(e){return e?e.startsWith("http://")||e.startsWith("https://")||e.startsWith("img/")?e:`img/${e}`:""}};window.ImageManager=s;
