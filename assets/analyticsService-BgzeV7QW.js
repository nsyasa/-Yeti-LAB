import{S as b}from"./router-CF1iH7HH.js";const f=()=>b.getClient(),l={from:(...i)=>f().from(...i),auth:{getUser:()=>f().auth.getUser()},rpc:(...i)=>f().rpc(...i)},p={_cache:{},_cacheExpiry:5*60*1e3,async getDashboardSummary(){const{data:{user:i}}=await f().auth.getUser();if(!i)throw new Error("Oturum bulunamadÄ±");const{data:n}=await f().from("classrooms").select("id").eq("teacher_id",i.id);if(!n||n.length===0)return this._getEmptySummary();const e=n.map(r=>r.id),[u,o,s,h]=await Promise.all([f().from("students").select("id",{count:"exact",head:!0}).in("classroom_id",e),f().from("assignments").select("id, status",{count:"exact"}).in("classroom_id",e),l.from("submissions").select("id, status, score").in("assignment_id",(await f().from("assignments").select("id").in("classroom_id",e)).data?.map(r=>r.id)||[]),l.from("course_enrollments").select("id, status",{count:"exact"}).in("classroom_id",e).eq("status","active")]),t=s.data||[],a=o.data||[],c=t.filter(r=>r.status==="submitted").length,m=t.filter(r=>r.status==="graded").length,g=t.filter(r=>r.score!==null).length>0?Math.round(t.filter(r=>r.score!==null).reduce((r,_)=>r+_.score,0)/t.filter(r=>r.score!==null).length):0,d=a.filter(r=>r.status==="published").length;return{totalStudents:u.count||0,totalClassrooms:n.length,totalAssignments:a.length,activeAssignments:d,totalSubmissions:t.length,pendingSubmissions:c,gradedSubmissions:m,averageScore:g,activeEnrollments:h.count||0}},_getEmptySummary(){return{totalStudents:0,totalClassrooms:0,totalAssignments:0,activeAssignments:0,totalSubmissions:0,pendingSubmissions:0,gradedSubmissions:0,averageScore:0,activeEnrollments:0}},async getSubmissionTrend(i=7){const{data:{user:n}}=await f().auth.getUser();if(!n)return[];const e=new Date;e.setDate(e.getDate()-i);const{data:u}=await l.from("classrooms").select("id").eq("teacher_id",n.id);if(!u||u.length===0)return[];const o=u.map(c=>c.id),{data:s}=await l.from("assignments").select("id").in("classroom_id",o);if(!s||s.length===0)return[];const h=s.map(c=>c.id),{data:t}=await l.from("submissions").select("created_at").in("assignment_id",h).gte("created_at",e.toISOString()).order("created_at",{ascending:!0}),a=[];for(let c=i-1;c>=0;c--){const m=new Date;m.setDate(m.getDate()-c);const g=m.toISOString().split("T")[0],d=t?.filter(r=>r.created_at.startsWith(g)).length||0;a.push({date:g,label:m.toLocaleDateString("tr-TR",{weekday:"short",day:"numeric"}),count:d})}return a},async getClassroomPerformance(){const{data:{user:i}}=await f().auth.getUser();if(!i)return[];const{data:n}=await l.from("classrooms").select(`
                id,
                name,
                students(count),
                assignments(
                    id,
                    submissions(score, status)
                )
            `).eq("teacher_id",i.id);return n?n.map(e=>{const u=e.students?.[0]?.count||0,o=e.assignments?.flatMap(a=>a.submissions||[])||[],s=o.filter(a=>a.status==="graded"&&a.score!==null),h=s.length>0?Math.round(s.reduce((a,c)=>a+c.score,0)/s.length):0,t=u>0&&e.assignments?.length>0?Math.round(o.length/(u*e.assignments.length)*100):0;return{id:e.id,name:e.name,studentCount:u,assignmentCount:e.assignments?.length||0,submissionCount:o.length,averageScore:h,submissionRate:t}}):[]},async getAssignmentStats(){const{data:{user:i}}=await f().auth.getUser();if(!i)return[];const{data:n}=await l.from("classrooms").select("id, name, students(count)").eq("teacher_id",i.id);if(!n||n.length===0)return[];const e=n.map(s=>s.id),u=Object.fromEntries(n.map(s=>[s.id,s])),{data:o}=await l.from("assignments").select(`
                id,
                title,
                status,
                due_date,
                max_score,
                classroom_id,
                submissions(id, status, score, submitted_at)
            `).in("classroom_id",e).order("created_at",{ascending:!1}).limit(10);return o?o.map(s=>{const t=u[s.classroom_id]?.students?.[0]?.count||0,a=s.submissions||[],c=a.filter(d=>d.status==="graded"&&d.score!==null),m=c.length>0?Math.round(c.reduce((d,r)=>d+r.score,0)/c.length):null,g=a.filter(d=>!s.due_date||!d.submitted_at?!1:new Date(d.submitted_at)>new Date(s.due_date)).length;return{id:s.id,title:s.title,status:s.status,dueDate:s.due_date,maxScore:s.max_score,classroomName:s.classrooms?.name||"",studentCount:t,submissionCount:a.length,submissionRate:t>0?Math.round(a.length/t*100):0,gradedCount:c.length,averageScore:m,lateSubmissions:g}}):[]},async getTopStudents(i=5){const{data:{user:n}}=await f().auth.getUser();if(!n)return[];const{data:e}=await l.from("classrooms").select("id").eq("teacher_id",n.id);if(!e||e.length===0)return[];const u=e.map(a=>a.id),{data:o}=await l.from("students").select("id, name, username, avatar_url, classroom_id").in("classroom_id",u);if(!o||o.length===0)return[];const s=o.map(a=>a.id),{data:h}=await l.from("submissions").select("student_id, score, status").in("student_id",s);return o.map(a=>{const c=h?.filter(r=>r.student_id===a.id)||[],m=c.filter(r=>r.status==="graded"&&r.score!==null),g=m.reduce((r,_)=>r+_.score,0),d=m.length>0?Math.round(g/m.length):0;return{id:a.id,name:a.name,username:a.username,avatar:a.avatar_url,submissionCount:c.length,averageScore:d,totalScore:g}}).sort((a,c)=>c.averageScore-a.averageScore).slice(0,i)},async getSubmissionStatusDistribution(){const{data:{user:i}}=await f().auth.getUser();if(!i)return{submitted:0,graded:0,late:0,draft:0};const{data:n}=await l.from("classrooms").select("id").eq("teacher_id",i.id);if(!n||n.length===0)return{submitted:0,graded:0,late:0,draft:0};const e=n.map(t=>t.id),{data:u}=await l.from("assignments").select("id").in("classroom_id",e);if(!u||u.length===0)return{submitted:0,graded:0,late:0,draft:0};const o=u.map(t=>t.id),{data:s}=await l.from("submissions").select("status").in("assignment_id",o),h={submitted:0,graded:0,late_submitted:0,draft:0,revision_requested:0};return s?.forEach(t=>{h[t.status]!==void 0&&h[t.status]++}),h},async getWeeklyActivityHeatmap(){const{data:{user:i}}=await f().auth.getUser();if(!i)return[];const n=new Date;n.setDate(n.getDate()-28);const{data:e}=await l.from("classrooms").select("id").eq("teacher_id",i.id);if(!e||e.length===0)return[];const u=e.map(m=>m.id),{data:o}=await l.from("assignments").select("id").in("classroom_id",u);if(!o||o.length===0)return[];const s=o.map(m=>m.id),{data:h}=await l.from("submissions").select("created_at").in("assignment_id",s).gte("created_at",n.toISOString()),t={},a=["Paz","Pzt","Sal","Ã‡ar","Per","Cum","Cmt"];a.forEach((m,g)=>{t[g]={};for(let d=0;d<24;d++)t[g][d]=0}),h?.forEach(m=>{const g=new Date(m.created_at),d=g.getDay(),r=g.getHours();t[d][r]++});const c=[];return a.forEach((m,g)=>{for(let d=8;d<=22;d++)c.push({day:m,dayIndex:g,hour:d,hourLabel:`${d.toString().padStart(2,"0")}:00`,count:t[g][d]})}),c},async getCourseCompletionRates(){const{data:{user:i}}=await f().auth.getUser();if(!i)return[];const{data:n}=await f().from("course_completion_rates").select("*");return n||[]},async getRecentActivity(i=10){const{data:{user:n}}=await f().auth.getUser();if(!n)return[];const{data:e}=await l.from("classrooms").select("id").eq("teacher_id",n.id);if(!e||e.length===0)return[];const u=e.map(t=>t.id),{data:o}=await l.from("assignments").select("id").in("classroom_id",u);if(!o||o.length===0)return[];const s=o.map(t=>t.id),{data:h}=await l.from("submissions").select(`
                id,
                status,
                score,
                created_at,
                submitted_at,
                graded_at,
                students(name, avatar_url),
                assignments(title)
            `).in("assignment_id",s).order("created_at",{ascending:!1}).limit(i);return h?.map(t=>({id:t.id,type:t.status==="graded"?"graded":"submitted",studentName:t.students?.name||"Bilinmeyen",studentAvatar:t.students?.avatar_url,assignmentTitle:t.assignments?.title||"",score:t.score,createdAt:t.created_at,submittedAt:t.submitted_at,gradedAt:t.graded_at}))||[]}};export{p as default};
