const p={async getAssignments(e={}){const{classroomId:r=null,courseId:t=null,status:s=null,limit:i=50,offset:o=0,orderBy:n="created_at",orderDirection:a="desc"}=e;try{const l=window.SupabaseClient?.client;if(!l)throw new Error("Supabase client not initialized");let c=l.from("assignments").select(`
                    *,
                    classroom:classrooms(id, name, code),
                    course:courses(id, title, slug)
                `).order(n,{ascending:a==="asc"}).range(o,o+i-1);r&&(c=c.eq("classroom_id",r)),t&&(c=c.eq("course_id",t)),s&&(c=c.eq("status",s));const{data:d,error:u}=await c;if(u)throw u;return d||[]}catch(l){throw console.error("[AssignmentService] getAssignments error:",l),l}},async getAssignment(e){try{const r=window.SupabaseClient?.client;if(!r)throw new Error("Supabase client not initialized");const{data:t,error:s}=await r.from("assignments").select(`
                    *,
                    classroom:classrooms(id, name, code),
                    course:courses(id, title, slug)
                `).eq("id",e).single();if(s)throw s;return t}catch(r){throw console.error("[AssignmentService] getAssignment error:",r),r}},async createAssignment(e){try{const r=window.SupabaseClient?.client;if(!r)throw new Error("Supabase client not initialized");const{data:{user:t}}=await r.auth.getUser();if(!t)throw new Error("User not authenticated");const s={teacher_id:t.id,classroom_id:e.classroom_id||null,course_id:e.course_id||null,project_id:e.project_id||null,title:e.title,description:e.description||"",instructions:e.instructions||"",due_date:e.due_date||null,max_points:e.max_points||100,assignment_type:e.assignment_type||"project",allow_late_submission:e.allow_late_submission??!0,late_penalty_percent:e.late_penalty_percent||10,max_attempts:e.max_attempts||1,status:e.status||"draft",settings:e.settings||{}},{data:i,error:o}=await r.from("assignments").insert(s).select().single();if(o)throw o;return e.rubric&&e.rubric.length>0&&await this.createRubric(i.id,e.rubric),i}catch(r){throw console.error("[AssignmentService] createAssignment error:",r),r}},async updateAssignment(e,r){try{const t=window.SupabaseClient?.client;if(!t)throw new Error("Supabase client not initialized");const{data:s,error:i}=await t.from("assignments").update(r).eq("id",e).select().single();if(i)throw i;return r.rubric!==void 0&&await this.updateRubric(e,r.rubric),s}catch(t){throw console.error("[AssignmentService] updateAssignment error:",t),t}},async deleteAssignment(e){try{const r=window.SupabaseClient?.client;if(!r)throw new Error("Supabase client not initialized");const{error:t}=await r.from("assignments").update({status:"archived"}).eq("id",e);if(t)throw t;return!0}catch(r){throw console.error("[AssignmentService] deleteAssignment error:",r),r}},async publishAssignment(e){return this.updateAssignment(e,{status:"active",published_at:new Date().toISOString()})},async closeAssignment(e){return this.updateAssignment(e,{status:"closed"})},async createRubric(e,r){try{const t=window.SupabaseClient?.client;if(!t)throw new Error("Supabase client not initialized");const s=r.map((n,a)=>({assignment_id:e,criterion_name:n.name,criterion_description:n.description||"",max_points:n.max_points||10,position:a+1,levels:n.levels||this.getDefaultLevels(n.max_points||10)})),{data:i,error:o}=await t.from("rubrics").insert(s).select();if(o)throw o;return i}catch(t){throw console.error("[AssignmentService] createRubric error:",t),t}},async updateRubric(e,r){try{const t=window.SupabaseClient?.client;if(!t)throw new Error("Supabase client not initialized");return await t.from("rubrics").delete().eq("assignment_id",e),r&&r.length>0?await this.createRubric(e,r):[]}catch(t){throw console.error("[AssignmentService] updateRubric error:",t),t}},getDefaultLevels(e){return[{name:"MÃ¼kemmel",points:e,description:"TÃ¼m kriterleri eksiksiz karÅŸÄ±lÄ±yor"},{name:"Ä°yi",points:Math.round(e*.75),description:"Kriterlerin Ã§oÄŸunu karÅŸÄ±lÄ±yor"},{name:"Orta",points:Math.round(e*.5),description:"Temel kriterleri karÅŸÄ±lÄ±yor"},{name:"GeliÅŸtirilmeli",points:Math.round(e*.25),description:"Ã–nemli eksiklikler var"},{name:"Yetersiz",points:0,description:"Kriterleri karÅŸÄ±lamÄ±yor"}]},async getSubmissions(e,r={}){const{status:t=null,limit:s=100}=r;try{const i=window.SupabaseClient?.client;if(!i)throw new Error("Supabase client not initialized");let o=i.from("submissions").select(`
                    *,
                    student:profiles!submissions_student_id_fkey(id, display_name, avatar_url, email),
                    files:submission_files(*)
                `).eq("assignment_id",e).order("submitted_at",{ascending:!1}).limit(s);t&&(o=o.eq("status",t));const{data:n,error:a}=await o;if(a)throw a;return n}catch(i){throw console.error("[AssignmentService] getSubmissions error:",i),i}},async gradeSubmission(e,r){try{const t=window.SupabaseClient?.client;if(!t)throw new Error("Supabase client not initialized");const{data:{user:s}}=await t.auth.getUser();if(!s)throw new Error("User not authenticated");const i={grade:r.grade,feedback:r.feedback||"",rubric_scores:r.rubric_scores||null,graded_by:s.id,graded_at:new Date().toISOString(),status:"graded"},{data:o,error:n}=await t.from("submissions").update(i).eq("id",e).select().single();if(n)throw n;return o}catch(t){throw console.error("[AssignmentService] gradeSubmission error:",t),t}},async requestRevision(e,r){try{const t=window.SupabaseClient?.client;if(!t)throw new Error("Supabase client not initialized");const{data:s,error:i}=await t.from("submissions").update({status:"revision_requested",feedback:r}).eq("id",e).select().single();if(i)throw i;return s}catch(t){throw console.error("[AssignmentService] requestRevision error:",t),t}},async getAssignmentStats(e){try{const r=window.SupabaseClient?.client;if(!r)throw new Error("Supabase client not initialized");const{data:t,error:s}=await r.from("submissions").select("status, grade").eq("assignment_id",e);if(s)throw s;const i={total:t.length,submitted:t.filter(n=>n.status==="submitted").length,graded:t.filter(n=>n.status==="graded").length,revision_requested:t.filter(n=>n.status==="revision_requested").length,average_grade:0},o=t.filter(n=>n.grade!==null);return o.length>0&&(i.average_grade=o.reduce((n,a)=>n+a.grade,0)/o.length),i}catch(r){throw console.error("[AssignmentService] getAssignmentStats error:",r),r}},async getClassroomStudentCount(e){try{const r=window.SupabaseClient?.client;if(!r)throw new Error("Supabase client not initialized");const{count:t,error:s}=await r.from("classroom_students").select("*",{count:"exact",head:!0}).eq("classroom_id",e);if(s)throw s;return t||0}catch(r){return console.error("[AssignmentService] getClassroomStudentCount error:",r),0}},async getTeacherClassrooms(){try{const e=window.SupabaseClient?.client;if(!e)throw new Error("Supabase client not initialized");const{data:{user:r}}=await e.auth.getUser();if(!r)throw new Error("User not authenticated");const{data:t,error:s}=await e.from("classrooms").select("id, name, code, is_active").eq("teacher_id",r.id).eq("is_active",!0).order("name");if(s)throw s;return t||[]}catch(e){return console.error("[AssignmentService] getTeacherClassrooms error:",e),[]}},async getCourses(){try{const e=window.SupabaseClient?.client;if(!e)throw new Error("Supabase client not initialized");const{data:r,error:t}=await e.from("courses").select("id, title, slug").order("title");if(t)throw t;return r||[]}catch(e){return console.error("[AssignmentService] getCourses error:",e),[]}},formatDate(e){return e?new Date(e).toLocaleDateString("tr-TR",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-"},getTimeRemaining(e){if(!e)return{text:"SÃ¼resiz",isOverdue:!1,isUrgent:!1};const r=new Date,s=new Date(e)-r;if(s<0)return{text:"SÃ¼resi doldu",isOverdue:!0,isUrgent:!1};const i=Math.floor(s/(1e3*60*60*24)),o=Math.floor(s%(1e3*60*60*24)/(1e3*60*60));return i>7?{text:`${i} gÃ¼n`,isOverdue:!1,isUrgent:!1}:i>0?{text:`${i} gÃ¼n ${o} saat`,isOverdue:!1,isUrgent:i<=2}:{text:`${o} saat`,isOverdue:!1,isUrgent:!0}},getStatusBadge(e){const r={draft:'<span class="px-2 py-1 text-xs font-medium rounded-full bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-300">ğŸ“ Taslak</span>',active:'<span class="px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400">âœ… Aktif</span>',closed:'<span class="px-2 py-1 text-xs font-medium rounded-full bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400">ğŸ”’ KapalÄ±</span>',archived:'<span class="px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400">ğŸ—„ï¸ ArÅŸiv</span>'};return r[e]||r.draft},getTypeBadge(e){const r={project:'<span class="px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400">ğŸ¯ Proje</span>',homework:'<span class="px-2 py-1 text-xs font-medium rounded-full bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400">ğŸ“š Ã–dev</span>',quiz:'<span class="px-2 py-1 text-xs font-medium rounded-full bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400">â“ Quiz</span>',exam:'<span class="px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400">ğŸ“ SÄ±nav</span>'};return r[e]||r.project}};window.AssignmentService=p;export{p as AssignmentService,p as default};
