const n={config:{getComponentInfo:()=>({}),onUpdate:null,onComponentSelect:null},currentKey:null,get data(){return this.config.getComponentInfo()||{}},get onUpdate(){return this.config.onUpdate},get onLoad(){return this.config.onComponentSelect},init(e){e&&e.getComponentInfo?this.config={...this.config,...e}:console.warn("[ComponentManager] Using legacy init mode"),this.currentKey=null,this.renderList()},renderList:()=>{const e=document.getElementById("component-list");if(e){e.innerHTML="";try{Object.entries(n.data).forEach(([t,o])=>{if(window.ComponentsSection&&ComponentsSection.renderComponentCard){const i={id:t,name:o.name||t,icon:o.icon||"ðŸ“¦",category:o.category||"basic",description:o.desc||o.description||""};e.innerHTML+=ComponentsSection.renderComponentCard(i)}else{const i=t===n.currentKey?"bg-purple-50 border-purple-500":"hover:bg-gray-50 border-transparent";e.innerHTML+=`
                        <div onclick="ComponentManager.load('${t}')" class="p-3 border-l-4 cursor-pointer transition ${i}">
                            <div class="flex items-center">
                                <span class="text-xl mr-3">${o.icon||"ðŸ“¦"}</span>
                                <div>
                                    <div class="font-bold text-sm text-gray-700">${o.name||t}</div>
                                    <div class="text-xs text-gray-400 font-mono">${t}</div>
                                </div>
                            </div>
                        </div>`}})}catch(t){console.error("Error rendering component list:",t),e.innerHTML+='<div class="p-2 text-red-500 text-xs">Hata: Elemanlar yÃ¼klenirken sorun oluÅŸtu.</div>'}}},load:e=>{n.currentKey=e;const t=n.data[e];if(!t)return;const o=document.getElementById("component-welcome"),i=document.getElementById("component-form");o&&o.classList.add("hidden"),i&&i.classList.remove("hidden");const d=(c,a)=>{const r=document.getElementById(c);r&&(r.value=a||"")};d("c-key",e),d("c-name",t.name),d("c-icon",t.icon),d("c-imgFileName",t.imgFileName),d("c-desc",t.desc),n.renderList(),n.onLoad&&n.onLoad(e)},update:()=>{if(!n.currentKey)return;const e=n.data[n.currentKey];if(!e)return;const t=o=>{const i=document.getElementById(o);return i?i.value:""};e.name=t("c-name"),e.icon=t("c-icon"),e.imgFileName=t("c-imgFileName"),e.desc=t("c-desc"),n.renderList(),n.onUpdate&&n.onUpdate()},add:()=>{const e=prompt("Yeni eleman iÃ§in benzersiz bir ID girin (Ã¶rn: sensor_dht11):");if(e){if(n.data[e]){alert("Bu ID zaten kullanÄ±lÄ±yor!");return}n.data[e]={name:"Yeni Malzeme",icon:"ðŸ“¦",imgFileName:"",desc:"AÃ§Ä±klama..."},n.load(e),n.onUpdate&&n.onUpdate()}},delete:()=>{if(!n.currentKey||!confirm("Bu malzemeyi silmek istediÄŸinize emin misiniz?"))return;delete n.data[n.currentKey],n.currentKey=null;const e=document.getElementById("component-welcome"),t=document.getElementById("component-form");e&&e.classList.remove("hidden"),t&&t.classList.add("hidden"),n.renderList(),n.onUpdate&&n.onUpdate()},edit:e=>{const t=document.getElementById("component-edit-modal");if(!t){n.load(e);return}const o=n.data[e];if(!o)return;n.currentKey=e;const i=(c,a)=>{const r=document.getElementById(c);r&&(r.value=a||"")};i("comp-edit-id",e),i("comp-edit-icon",o.icon),i("comp-edit-name",o.name),i("comp-edit-category",o.category||"basic"),i("comp-edit-description",o.desc||o.description||""),i("comp-edit-quantity",o.quantity||"1"),i("comp-edit-unit",o.unit||"adet"),t.classList.remove("hidden"),t.classList.add("flex");const d=document.getElementById("component-edit-form");d&&(d.onsubmit=c=>{c.preventDefault(),n.saveFromModal()})},closeEditModal:()=>{const e=document.getElementById("component-edit-modal");e&&(e.classList.add("hidden"),e.classList.remove("flex"))},saveFromModal:()=>{const e=n.currentKey;if(!e||!n.data[e])return;const t=n.data[e],o=i=>{const d=document.getElementById(i);return d?d.value:""};t.icon=o("comp-edit-icon")||"ðŸ“¦",t.name=o("comp-edit-name")||"Ä°simsiz",t.category=o("comp-edit-category")||"basic",t.desc=o("comp-edit-description"),t.description=t.desc,t.quantity=parseInt(o("comp-edit-quantity"))||1,t.unit=o("comp-edit-unit")||"adet",n.closeEditModal(),n.renderList(),n.onUpdate&&n.onUpdate()},deleteById:e=>{if(!e||!n.data[e])return;const t=n.data[e].name||e;confirm(`"${t}" elemanÄ±nÄ± silmek istediÄŸinize emin misiniz?`)&&(delete n.data[e],n.currentKey===e&&(n.currentKey=null),n.closeEditModal(),n.renderList(),n.onUpdate&&n.onUpdate())}};window.ComponentManager=n;
