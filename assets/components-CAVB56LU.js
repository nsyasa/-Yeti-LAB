const t={config:{getComponentInfo:()=>({}),onUpdate:null,onComponentSelect:null},currentKey:null,get data(){return this.config.getComponentInfo()||{}},get onUpdate(){return this.config.onUpdate},get onLoad(){return this.config.onComponentSelect},init(e){e&&e.getComponentInfo?this.config={...this.config,...e}:console.warn("[ComponentManager] Using legacy init mode"),this.currentKey=null,this.renderList()},renderList:()=>{const e=document.getElementById("component-list");if(e){e.innerHTML="";try{Object.entries(t.data).forEach(([n,o])=>{if(window.ComponentsSection&&ComponentsSection.renderComponentCard){const i={id:n,name:o.name||n,icon:o.icon||"ðŸ“¦",category:o.category||"basic",description:o.desc||o.description||""};e.innerHTML+=ComponentsSection.renderComponentCard(i)}else{const i=n===t.currentKey?"bg-purple-50 border-purple-500":"hover:bg-gray-50 border-transparent",c=Utils.escapeHtml(String(n??"")),a=Utils.escapeHtml(String(o?.name??n)),r=Utils.escapeHtml(String(o?.icon??"ðŸ“¦")),d=JSON.stringify(String(n??""));e.innerHTML+=`
                        <div onclick="ComponentManager.load(${d})" class="p-3 border-l-4 cursor-pointer transition ${i}">
                            <div class="flex items-center">
                                <span class="text-xl mr-3">${r}</span>
                                <div>
                                    <div class="font-bold text-sm text-gray-700">${a}</div>
                                    <div class="text-xs text-gray-400 font-mono">${c}</div>
                                </div>
                            </div>
                        </div>`}})}catch(n){console.error("Error rendering component list:",n),e.innerHTML+='<div class="p-2 text-red-500 text-xs">Hata: Elemanlar yÃ¼klenirken sorun oluÅŸtu.</div>'}}},load:e=>{t.currentKey=e;const n=t.data[e];if(!n)return;const o=document.getElementById("component-welcome"),i=document.getElementById("component-form");o&&o.classList.add("hidden"),i&&i.classList.remove("hidden");const c=(a,r)=>{const d=document.getElementById(a);d&&(d.value=r||"")};c("c-key",e),c("c-name",n.name),c("c-icon",n.icon),c("c-imgFileName",n.imgFileName),c("c-desc",n.desc),t.renderList(),t.onLoad&&t.onLoad(e)},update:()=>{if(!t.currentKey)return;const e=t.data[t.currentKey];if(!e)return;const n=o=>{const i=document.getElementById(o);return i?i.value:""};e.name=n("c-name"),e.icon=n("c-icon"),e.imgFileName=n("c-imgFileName"),e.desc=n("c-desc"),t.renderList(),t.onUpdate&&t.onUpdate()},add:()=>{const e=prompt("Yeni eleman iÃ§in benzersiz bir ID girin (Ã¶rn: sensor_dht11):");if(e){if(t.data[e]){alert("Bu ID zaten kullanÄ±lÄ±yor!");return}t.data[e]={name:"Yeni Malzeme",icon:"ðŸ“¦",imgFileName:"",desc:"AÃ§Ä±klama..."},t.load(e),t.onUpdate&&t.onUpdate()}},delete:()=>{if(!t.currentKey||!confirm("Bu malzemeyi silmek istediÄŸinize emin misiniz?"))return;delete t.data[t.currentKey],t.currentKey=null;const e=document.getElementById("component-welcome"),n=document.getElementById("component-form");e&&e.classList.remove("hidden"),n&&n.classList.add("hidden"),t.renderList(),t.onUpdate&&t.onUpdate()},edit:e=>{const n=document.getElementById("component-edit-modal");if(!n){t.load(e);return}const o=t.data[e];if(!o)return;t.currentKey=e;const i=(a,r)=>{const d=document.getElementById(a);d&&(d.value=r||"")};i("comp-edit-id",e),i("comp-edit-icon",o.icon),i("comp-edit-name",o.name),i("comp-edit-category",o.category||"basic"),i("comp-edit-description",o.desc||o.description||""),i("comp-edit-quantity",o.quantity||"1"),i("comp-edit-unit",o.unit||"adet"),n.classList.remove("hidden"),n.classList.add("flex");const c=document.getElementById("component-edit-form");c&&(c.onsubmit=a=>{a.preventDefault(),t.saveFromModal()})},closeEditModal:()=>{const e=document.getElementById("component-edit-modal");e&&(e.classList.add("hidden"),e.classList.remove("flex"))},saveFromModal:()=>{const e=t.currentKey;if(!e||!t.data[e])return;const n=t.data[e],o=i=>{const c=document.getElementById(i);return c?c.value:""};n.icon=o("comp-edit-icon")||"ðŸ“¦",n.name=o("comp-edit-name")||"Ä°simsiz",n.category=o("comp-edit-category")||"basic",n.desc=o("comp-edit-description"),n.description=n.desc,n.quantity=parseInt(o("comp-edit-quantity"))||1,n.unit=o("comp-edit-unit")||"adet",t.closeEditModal(),t.renderList(),t.onUpdate&&t.onUpdate()},deleteById:e=>{if(!e||!t.data[e])return;const n=t.data[e].name||e;confirm(`"${n}" elemanÄ±nÄ± silmek istediÄŸinize emin misiniz?`)&&(delete t.data[e],t.currentKey===e&&(t.currentKey=null),t.closeEditModal(),t.renderList(),t.onUpdate&&t.onUpdate())}};window.ComponentManager=t;
